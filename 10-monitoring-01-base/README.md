# Домашнее задание к занятию 13 «Введение в мониторинг»

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск.
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

---

+ Метрики использования процессора (CPU): важный показатель, так как в ТЗ указано, что вычисления загружают ЦПУ. Можно отслеживать такие метрики, как среднее использование процессора, пиковое использование и время работы без прерываний

+ Метрики использования памяти: Поскольку платформа выполняет вычисления и генерирует отчеты, необходимо отслеживать использование оперативной памяти. Включая метрики общего объема памяти, использованной памяти, свободной памяти и обеспечения достаточного пространства для новых задач

+ Метрики дисков: Отслеживание использования дискового пространства поможет определить, не исчерпано ли место для хранения отчетов, и предотвратить переполнение диска

+ Метрики сети: Учитывая, что взаимодействие с платформой осуществляется по протоколу HTTP, важно отслеживать метрики сетевого использования, такие как средняя загрузка сети и время отклика сервиса

+ Метрики доступности сервисов: Следует отслеживать успешность обработки запросов и время отклика сервиса, чтобы убедиться, что сервисы работают стабильно и не прекращают работу

Этот набор метрик даст нам базовое представление о производительности системы и позволит выявить возможные узкие места или проблемы, которые могут возникнуть во время эксплуатации. Они также помогут нам оптимизировать ресурсы и обеспечить высокую доступность сервисов.

---

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

Дабы не погружать менеджера в технические особенности, можно отдельно для него вывести метрики, на основе будет складываться понимание о качестве обслуживания:

+ Среднее время ответа (Response Time): Время, которое требуется для обработки запроса пользователя и отправки ответа. Это покажет, насколько быстро система реагирует на запросы пользователей

+ Тактовая частота (Load Average): Среднее количество процессов, ожидающих выполнения в системе, за последние 1, 5 и 15 минут. Это может указывать на загруженность сервера и его способность обрабатывать запросы

+ Количество активных пользователей (Active Users): Количество одновременно подключенных пользователей, которые используют сервис. Это даст представление о нагрузке на сервер и его способности обслуживать всех пользователей

+ Ошибки и исключения (Errors and Exceptions): Количество ошибок и исключений, которые происходят в системе. Это поможет определить, сколько проблем возникает и как они влияют на обслуживание клиентов

+ Активность пользователей (User Activity Metrics): Статистика действий пользователей, таких как количество выполненных операций, частота их посещения и другие активити, связанные с использованием сервиса

Используя эти метрики, менеджер продукта сможет лучше понять, как система функционирует и какое качество обслуживания она предоставляет клиентам.

---

3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

Если финансирование на построение системы сбора логов не выделено, но разработчикам необходимо видеть ошибки приложений, можно предложить следующие альтернативные решения:

+ Инструментирование кода: Разработчики должны быть обучены добавлять в код соответствующие записи логов, которые будут захватывать информацию о поведении приложения, ошибках и других значимых событиях в режиме реального времени

+ Использование существующих инструментов: Рассмотрите возможность использования бесплатных или открытых инструментов для сбора логов, таких как Fluentd или Logstash, которые могут автоматизировать процесс агрегации логов из различных источников

+ Централизованный логирование: Интегрируйте инструменты централизованного логирования, чтобы собирать логи из разных источников в одном месте. Это позволит разработчикам быстро находить и анализировать ошибки

+ Хранение логов: Убедитесь, что есть надежное и масштабируемое хранилище для логов, чтобы логи были доступны для анализа и отладки. Используйте облачные решения, такие как Amazon S3, Google Cloud Storage или Azure Blob Storage, для долгосрочного хранения и архивирования логов

+ Анализ логов: Позвольте разработчикам использовать инструменты для анализа логов, такие как Kibana, для поиска и фильтрации логов, что поможет быстрее находить и устранять проблемы

+ Обратная связь от пользователей: Разработайте систему обратной связи от пользователей, которая будет собирать информацию о возникающих ошибках и отправлять ее разработчикам. Это может быть простой форма обратной связи или более сложная система для сбора отчетов об ошибках

+ Аудит и мониторинг: Используйте инструменты мониторинга для отслеживания производительности приложения и выявления ошибок в реальном времени. Это поможет команде быстрее реагировать на проблемы и улучшать качество обслуживания



4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов.
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

если в нашей системе нет ни одного запроса с кодом 5xx или 4xx, это может означать, что вычисление summ_2xx_requests или summ_all_requests некорректно. Возможно, в нашей системе не учитываются некоторые типы запросов, которые фактически являются успешными.

Например:

+ Код ответа 3xx: Перенаправления, такие как 301 (Moved Permanently) или 302 (Found).

+ Код ответа 1xx: Информационные статусы, такие как 100 (Continue) или 101 (Switching Protocols).

В формулу для расчета потребуется добавить эти виды запросов.


## Дополнительное задание* (со звёздочкой)

Выполнение этого задания необязательно и никак не влияет на получение зачёта по домашней работе.

_____

Вы устроились на работу в стартап. На данный момент у вас нет возможности развернуть полноценную систему
мониторинга, и вы решили самостоятельно написать простой python3-скрипт для сбора основных метрик сервера.

Вы, как опытный системный администратор, знаете, что системная информация сервера лежит в директории `/proc`. Также знаете, что в системе Linux есть  планировщик задач cron, который может запускать задачи по расписанию.

Суммировав всё, вы спроектировали приложение, которое:

- является python3-скриптом;
- собирает метрики из папки `/proc`;
- складывает метрики в файл 'YY-MM-DD-awesome-monitoring.log' в директорию /var/log
(YY — год, MM — месяц, DD — день);
- каждый сбор метрик складывается в виде json-строки, в виде:
  + timestamp — временная метка, int, unixtimestamp;
  + CPU-load — метрика 1;
  + memory used — метрика 2;
  + /var/log size - метрика 3;
  + disk utilization - метрика 4;

     ...

  + metric_N — метрика N.

- сбор метрик происходит каждую минуту по cron-расписанию.

Для успешного выполнения задания нужно привести:

* работающий код python3-скрипта;
* конфигурацию cron-расписания;
* пример верно сформированного 'YY-MM-DD-awesome-monitoring.log', имеющий не меньше пяти записей.

Дополнительная информация:

1. Количество собираемых метрик должно быть не меньше четырёх.
1. По желанию можно не ограничивать себя только сбором метрик из `/proc`.

---
Получилось сделать не напрямую с данными через proc, а через отдельный модуль psutil
ссылка на скрипт 

https://github.com/ivanmalyshev/mnt-homeworks/blob/MNT-video/10-monitoring-01-base/monitoring.py

Вид лога
```
tail -f /var/log/2024-02-10-awesome-monitoring.log
{"timestamp": 1707570524, "CPU-load": 0.0, "memory used": 66.0, "/var/log size": 7767510445, "disk utilization": 65.2}
{"timestamp": 1707570841, "CPU-load": 0.0, "memory used": 66.2, "/var/log size": 7767846934, "disk utilization": 65.2}
{"timestamp": 1707570901, "CPU-load": 0.0, "memory used": 66.6, "/var/log size": 7767907627, "disk utilization": 65.2}
{"timestamp": 1707570962, "CPU-load": 0.0, "memory used": 67.3, "/var/log size": 7767988046, "disk utilization": 65.2}
{"timestamp": 1707571021, "CPU-load": 66.7, "memory used": 66.0, "/var/log size": 7768043478, "disk utilization": 65.2}
{"timestamp": 1707571081, "CPU-load": 0.0, "memory used": 66.2, "/var/log size": 7768107259, "disk utilization": 65.2}
```

Задание крон
```
* * * * * root /usr/bin/python3 /home/mid/Nextcloud/netology/mnt-homeworks/10-monitoring-01-base/monitoring.py

```
